<script type="text/discourse-plugin" version="0.8">
    const { h } = require('virtual-dom');
    const { iconNode } = require('discourse-common/lib/icon-library');

    // This renames the reference to the “bars” icon to “disraptor-bars-icon”.
    // This way, we can reference the “bars” icon with a different name (i.e. disraptor-bars-icon).
    api.replaceIcon('disraptor-bars', 'bars')

    // This renames the reference to the “fab-discourse” to “bars”.
    // Since the “fab-discourse” is originally used for Discourse’s main navigation, it will now use the “bars” icon.
    api.replaceIcon('bars', 'fab-discourse');

    // header-contents:after inserts after div.contents.clearfix
    api.decorateWidget('header-icons:after', function () {
        return createHeaderIcon();
    });

    const disraptorNavItems = [
        {
            text: 'Home',
            href: '/'
        },
        {
            text: 'Test',
            href: '/tira9-client-web/tasks'
        }
    ];

    function createHeaderIcon() {
        return h(
            'li.header-dropdown-toggle',
            [
                h(
                    'button.toggle-disraptor-menu.icon.btn-flat',
                    {
                        type: 'button',
                        onclick: toggleDisraptorNav,
                        attributes: {
                            'aria-label': 'Disraptor Nav',
                            'aria-expanded': 'false'
                        }
                    },
                    iconNode('disraptor-bars')
                ),
                h(
                    'div.menu-panel',
                    {
                        attributes: {
                            'data-max-width', '320'
                        }
                    },
                    [
                        h(
                            'div.panel-body'
                            [
                                h('ul.disraptor-menu', getDisraptorNavItems())
                            ]
                        )
                    ]
                )
            ]
        );
    }

    function getDisraptorNavItems() {
        return disraptorNavItems.map(item => {
            return h(
                'li',
                [
                    h('a', { href: item.href }, item.text)
                ]
            );
        });
    }

    function toggleDisraptorNav(event) {
        const isExpanded = event.currentTarget.getAttribute('aria-expanded') === 'true';
        event.currentTarget.setAttribute('aria-expanded', !isExpanded);
    }
</script>
